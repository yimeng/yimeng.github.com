<!doctype html><html lang=zh-cn><title>办公室实验环境 | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2024/office-lab/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2024/office-lab/>办公室实验环境</a></h1><p class=meta><time datetime=2024-02-02T10:45:00+08:00>February 02, 2024</time></p></header><h2 id=背景>背景</h2><p>日结工的公司发了一个加入域的windows11笔记本，没有管理员权限。只能放到那里当成一个大的打卡机，有点浪费。如何有效的利用起来？</p><h2 id=方案>方案</h2><p>正好对于gitops比较感兴趣，因此规划了如下几个场景功能：</p><ul><li>虚拟机</li><li>git仓库</li><li>利用vagrant和ci做一些镜像的测试工作</li></ul><h2 id=部署图>部署图</h2><p><img src=http://pic.chenym.net/blog/image-20240202104716512.png alt=image-20240202104716512></p><p>部署图如上，选取了gitea的一个二进制进行部署。然后使用cloudflare进行了泛域名解析，用traefik来进行域名的路由。gitea的runner负责在windows机器上执行各种命令。控制vagrant和VirtualBox来进行镜像打包。有时候这个机器的wifi可能不太好用，使用runner定时重启一下。别问我为啥不用windows自己的服务。没有管理员权限只能用这些骚操作了。</p><h2 id=代码>代码</h2><p>相关配置文件可以移步如下git仓库进行获取</p><pre tabindex=0><code>https://github.com/yimeng/office-lab.git
</code></pre><h2 id=问题>问题</h2><p>这个方案在runner那调用powershell或者cmd的时候会有一些问题，例如执行时间太长（调用vagrant的时候下载box），runner中看不到回显，排错问题等等。因此执行一些简单的任务还可以，用于ci操作系统镜像还是有点问题。可以建议将runner放到VirtualBox的linux的虚拟机中进行执行。避开windows没有管理员权限和调试的窘境。</p><h2 id=扩展>扩展</h2><p>如果可以还可以用cloudflare把相关端口暴露出去，这样就可以通过外网访问办公室的实验环境了，但需要做好相应的安全措施。但目前没有管理员权限，只能作罢。</p></article></html>