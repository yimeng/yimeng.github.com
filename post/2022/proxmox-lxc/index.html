<!doctype html><html lang=zh-cn><title>家庭电量可观测性 | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2022/proxmox-lxc/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2022/proxmox-lxc/>家庭电量可观测性</a></h1><p class=meta><time datetime=2022-05-03T09:19:00+08:00>May 03, 2022</time></p></header><h1 id=proxmox-lxc>proxmox-lxc</h1><h2 id=背景>背景</h2><h2 id=方案>方案</h2><h3 id=clone>clone</h3><h3 id=原生>原生</h3><h3 id=自己制作>自己制作</h3><p>Create lxc template with proxmox</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Step 1<span style=color:#f92672>)</span> Download the LXC/openVZ template
</span></span><span style=display:flex><span>Step 2<span style=color:#f92672>)</span> Create an LXC container with this template
</span></span><span style=display:flex><span>Step 3<span style=color:#f92672>)</span> Boot the container
</span></span><span style=display:flex><span>Step 4<span style=color:#f92672>)</span> Enter the container via console <span style=color:#f92672>(</span>pct enter &lt;id&gt;<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Step 5<span style=color:#f92672>)</span> Install / modifY anything you want
</span></span><span style=display:flex><span>Step 6<span style=color:#f92672>)</span> Remove the network configuration from the network interface
</span></span><span style=display:flex><span>Step 7<span style=color:#f92672>)</span> Shutdown the container
</span></span><span style=display:flex><span>Step 8<span style=color:#f92672>)</span> Make a backup with vzdump and <span style=color:#66d9ef>select</span> tar.gz as extension
</span></span><span style=display:flex><span>Step 9<span style=color:#f92672>)</span> Move and rename your xyz.tar.gz to /var/lib/vz/template/cache/template-version.tar.gz
</span></span><span style=display:flex><span>Step 10<span style=color:#f92672>)</span> Use your new template on new containers
</span></span></code></pre></div><p>Step 8&amp;9</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># https://billing.instantdedicated.com/index.php?rp=/knowledgebase/169/Create-lxc-template-with-proxmox.html</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/var/lib/vz/dump</span>
</span></span><span style=display:flex><span>root@homelab:/var/lib/vz/dump# vzdump <span style=color:#ae81ff>100</span> -compress gzip
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>INFO: starting new backup job: vzdump <span style=color:#ae81ff>100</span> --compress gzip
</span></span><span style=display:flex><span>INFO: Starting Backup of VM <span style=color:#ae81ff>100</span> <span style=color:#f92672>(</span>lxc<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>INFO: Backup started at 2022-05-26 00:16:48
</span></span><span style=display:flex><span>INFO: status <span style=color:#f92672>=</span> stopped
</span></span><span style=display:flex><span>INFO: backup mode: stop
</span></span><span style=display:flex><span>INFO: ionice priority: <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>INFO: CT Name: CT100
</span></span><span style=display:flex><span>INFO: including mount point rootfs <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>)</span> in backup
</span></span><span style=display:flex><span>INFO: creating vzdump archive <span style=color:#e6db74>&#39;/var/lib/vz/dump/vzdump-lxc-100-2022_05_26-00_16_48.tar.gz&#39;</span>
</span></span><span style=display:flex><span>INFO: Total bytes written: <span style=color:#ae81ff>611809280</span> <span style=color:#f92672>(</span>584MiB, 27MiB/s<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>INFO: archive file size: 189MB
</span></span><span style=display:flex><span>INFO: Finished Backup of VM <span style=color:#ae81ff>100</span> <span style=color:#f92672>(</span>00:00:22<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>INFO: Backup finished at 2022-05-26 00:17:10
</span></span><span style=display:flex><span>INFO: Backup job finished successfully
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp /var/lib/vz/dump/vzdump-lxc-100-2022_05_26-00_41_06.tar.zst /var/lib/vz/template/cache/
</span></span></code></pre></div><h2 id=问题>问题</h2><p>openssh 8.8 去除了ssh-rsa算法</p><p><a href=https://github.com/hashicorp/terraform/issues/29082>https://github.com/hashicorp/terraform/issues/29082</a></p><p><a href=https://github.com/hashicorp/terraform/issues/27768>https://github.com/hashicorp/terraform/issues/27768</a></p><p><a href=https://github.com/golang/go/issues/49952>https://github.com/golang/go/issues/49952</a></p><p><a href=https://github.com/golang/go/issues/39885>https://github.com/golang/go/issues/39885</a></p><p><a href=https://cloud.tencent.com/developer/article/1493298>https://cloud.tencent.com/developer/article/1493298</a></p><p><a href=https://www.turnkeylinux.org/tkldev>https://www.turnkeylinux.org/tkldev</a></p><p><a href=https://xuanwo.io/reports/2021-47/>https://xuanwo.io/reports/2021-47/</a></p><p><a href=https://cloud.tencent.com/developer/article/1878381>https://cloud.tencent.com/developer/article/1878381</a></p><p><a href=https://bbs.php8.win/d/43-aws-ec2ubuntu2204xshell>https://bbs.php8.win/d/43-aws-ec2ubuntu2204xshell</a></p><p><a href=https://cloud.tencent.com/developer/article/1493298>https://cloud.tencent.com/developer/article/1493298</a></p><p><a href=https://neil-wu.github.io/2020/04/04/2020-04-04-SSH-key/>https://neil-wu.github.io/2020/04/04/2020-04-04-SSH-key/</a></p><p><a href=https://vanmieghem.io/automating-proxmox-with-terraform-ansible/>https://vanmieghem.io/automating-proxmox-with-terraform-ansible/</a></p><p><a href=https://github.com/vivami/proxmox-automation>https://github.com/vivami/proxmox-automation</a></p><h2 id=结论>结论</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root 121M Nov <span style=color:#ae81ff>12</span>  <span style=color:#ae81ff>2021</span> ubuntu-21.10-standard_21.10-1_amd64.tar.zst
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root 124M Apr <span style=color:#ae81ff>24</span> 18:24 ubuntu-22.04-standard_22.04-1_amd64.tar.zst
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root 190M May <span style=color:#ae81ff>26</span> 00:26 vzdump-lxc-100-2022_05_26-00_16_48.tar.gz
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root 183M May <span style=color:#ae81ff>26</span> 00:42 vzdump-lxc-100-2022_05_26-00_41_06.tar.zst
</span></span></code></pre></div></article></html>