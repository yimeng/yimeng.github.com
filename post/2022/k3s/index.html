<!doctype html><html lang=zh-cn><title>k3s | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2022/k3s/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2022/k3s/>k3s</a></h1><p class=meta><time datetime=2022-05-03T09:19:00+08:00>May 03, 2022</time></p></header><h1 id=k3s学习笔记>K3S学习笔记</h1><p><a href=https://comphilip.wordpress.com/2021/05/30/k3s-thing-better-ipvs-solution/>https://comphilip.wordpress.com/2021/05/30/k3s-thing-better-ipvs-solution/</a></p><p><a href=https://comphilip.wordpress.com/2021/05/22/k3s-thing-ipvs-failure/>https://comphilip.wordpress.com/2021/05/22/k3s-thing-ipvs-failure/</a></p><p><a href=https://weinan.io/2020/05/23/k3s.html>https://weinan.io/2020/05/23/k3s.html</a></p><p><a href=https://www.modb.pro/db/383288>https://www.modb.pro/db/383288</a></p><p><a href=https://metallb.universe.tf/configuration/k3s/>https://metallb.universe.tf/configuration/k3s/</a></p><p><a href=https://int32bit.sh/2019/11/28/IPVS>https://int32bit.sh/2019/11/28/IPVS</a>从入门到精通kube-proxy实现原理/</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>K3S Master startup command: k3s server --node-external-ip 172.30.80.2 --advertise-address 172.30.81.2 --node-ip 172.30.81.2 --kube-proxy-arg proxy-mode<span style=color:#f92672>=</span>ipvs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>K3S Worker startup command: k3s agent --node-external-ip 172.30.80.3 --node-ip 172.30.81.3 --kube-proxy-arg proxy-mode<span style=color:#f92672>=</span>ipvs
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>################### master</span>
</span></span><span style=display:flex><span>export INSTALL_K3S_CHANNEL<span style=color:#f92672>=</span>latest
</span></span><span style=display:flex><span>export INSTALL_K3S_MIRROR<span style=color:#f92672>=</span>cn 
</span></span><span style=display:flex><span>export LIP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100.127.255.135&#34;</span>
</span></span><span style=display:flex><span>export EIP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100.127.255.133&#34;</span>
</span></span><span style=display:flex><span>export INSTALL_K3S_EXEC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server --tls-san </span>$LIP<span style=color:#e6db74> --node-ip </span>$LIP<span style=color:#e6db74> --advertise-address </span>$LIP<span style=color:#e6db74>  --node-external-ip </span>$EIP<span style=color:#e6db74>  --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 --kube-proxy-arg proxy-mode=ipvs masquerade-all=true --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#export INSTALL_K3S_EXEC=&#34;server --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># export INSTALL_K3S_EXEC=&#34;server --tls-san $IP --node-ip $IP --node-external-ip $IP --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2  --disable servicelb --kube-proxy-arg proxy-mode=ipvs masquerade-all=true --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | sh -s -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat /var/lib/rancher/k3s/server/node-token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################ agent </span>
</span></span><span style=display:flex><span>export LIP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100.127.255.136&#34;</span>
</span></span><span style=display:flex><span>export EIP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;100.127.255.132&#34;</span>
</span></span><span style=display:flex><span>export K3S_TOKEN<span style=color:#f92672>=</span>K10a8cec93b8572b2986d8fa0eba6aa3076d91ce19b374714a3e68ec4440a4c280a::server:9d9c38adc6578f7bb72ca372823989fc
</span></span><span style=display:flex><span>export INSTALL_K3S_CHANNEL<span style=color:#f92672>=</span>latest
</span></span><span style=display:flex><span>export INSTALL_K3S_MIRROR<span style=color:#f92672>=</span>cn 
</span></span><span style=display:flex><span>export K3S_URL<span style=color:#f92672>=</span>https://100.127.255.135:6443
</span></span><span style=display:flex><span><span style=color:#75715e>#export INSTALL_K3S_EXEC=&#34;--node-external-ip $IP --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2  --kube-proxy-arg proxy-mode=ipvs masquerade-all=true --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>export INSTALL_K3S_EXEC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--node-ip </span>$LIP<span style=color:#e6db74> --node-external-ip </span>$EIP<span style=color:#e6db74> --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2  --kube-proxy-arg proxy-mode=ipvs masquerade-all=true --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#export INSTALL_K3S_EXEC=&#34;--pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 --kube-proxy-arg metrics-bind-address=0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | sh -s -
</span></span></code></pre></div></article></html>