<!doctype html><html lang=zh-cn><title>家用DNS选择 | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2019/homedns/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2019/homedns/>家用DNS选择</a></h1><p class=meta><time datetime=2019-09-19T22:36:49+08:00>September 19, 2019</time></p></header><h1 id=家用dns选择>家用DNS选择</h1><h2 id=背景>背景</h2><p>折腾了下家里的路由器之后，发现DHCP分配的IP地址都乱了，以前用IP的一些服务无法运行。</p><p>用MAC绑定倒是可以解决这个问题，但是随之还是需要一个小的CMDB去存储这些信息，维护量还是存在。</p><p>于是就想找一个轻量级的DNS服务端来解决内网DNS的问题。</p><h2 id=需求>需求</h2><h3 id=必选>必选</h3><p>支持restful api的注册发现</p><p>轻量级</p><p>依赖少</p><p>迁移方便</p><p>文档丰富</p><p>学习成本低，知识复用</p><h3 id=可选>可选</h3><p>最好有web页面进行管理</p><p>高可用无所谓</p><h2 id=选型>选型</h2><p>Bind：比较熟悉了，但是太重，放弃。</p><p>PowerDNS：网上口碑不错，大多数人的选择，但是还是需要了解一些命令行和配置。还是有一定的学习成本的。而且无法迁移到生产上，知识投入产出比较低，感觉只是Bind的改进版。放弃。</p><p>CoreDNS：K8s组件之一，有学习成本但是可以移植到k8s上。有etcd服务发现的加持，二进制+配置文件，迁移和部署比较简单。</p><p>DNSmasq：路由器友好支持，和DHCP在一起。但是缺少服务发现和管理界面，不时之需的时候备选。或者路由器DNSmasq+CoreDNS的组合也是不错的。CoreDNS坏了用DNSmasq接管。</p><p>consul：天生就是服务发现的工具，也自带dns。就是不能递归。不过对于我来说足够用了。</p><h2 id=架构>架构</h2><p>本地server：CoreDNS+ETCD 配置放到git上作为备份</p><p>本地client：DNSmasq缓存dns查询 转发的coredns上</p><p>路由器DNSmasq负责dhcp</p></article></html>