<!doctype html><html lang=zh-cn><title>homelab再出发 | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2021/homelab/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2021/homelab/>homelab再出发</a></h1><p class=meta><time datetime=2021-08-19T22:46:00+08:00>August 19, 2021</time></p></header><h2 id=背景>背景</h2><p>以前配的一台homelab主机已经很多年了，配置如下：</p><ul><li><p>CPU：<em>Intel(R) Xeon(R) CPU E3-1235L v5 @ 2.00GHz</em> <strong>Cores:</strong> 4 <strong>Threads:</strong> 4 <strong>TDP:</strong> 25 W <strong>Turbo Speed:</strong> 3.0 GHz (cpubenchmark:5013)</p></li><li><p>内存：<strong>玖合(JUHOR) 16GB DDR4 2400</strong> *3</p></li><li><p>主板：Asus/华硕 P10S WS工作站主板C236芯片支持E3-v5 v6系列双M.2接口</p></li><li><p>硬盘：</p><ul><li>**惠普（HP）SSD固态硬盘 M.2接口(NVMe协议) EX920： 256G **</li><li>海康威视：C2000pro M.2 : 2T</li><li>西部数据：4T+2T+4T+1T+4T=15T</li></ul></li></ul><p>因为几次停电，西部数据的机械硬盘怕受不了太多的刺激，加上有些数据都是比较重要的。所以打算把这台ATX大小的机器作为存储。反正磁盘位还有4-5个，还有两个光驱位可以补充，但不太会在上面折腾了，平时用的时候再开。所以新的需求就来了。如果上天再给我一次选择的机会，我会如何配置呢？</p><p>当然，新电脑的需求还是取决于钱包里的兜子大小。一开始预算大概只有2-3k。然而，买东西这种事情，你懂的，跟买车一样，一开始我只想买个自行车，谁知道最后买了一个劳斯莱斯幻影。</p><p>虽然做了很充分的调研，然而最终可能还是买了一个总价5K的，并且最终商家发货之前还在犹豫是A还是B更好一些的问题。可见这个时代装机也是一件很纠结的事情。为了惊醒后人，纠结再三，还是把这次纠结的过程写下来比较好。</p><h2 id=需求>需求</h2><p>根据背景里介绍的那样，这次主要是为了平时做一些实验而买的（和老婆申请的理由）。所以根据现状分布式以及计算和存储分开的原则。本次购买的原则如下：</p><ul><li>体积要小（容易折腾,房子小折腾大家伙可以扔天津地下室）</li><li>性能要好一些（平时需求量不大，但希望能多开点虚拟机做实验）</li><li>内存要大（方便开虚拟机）</li><li>网口最好要多一些（方便做SDN实验）</li><li>要便宜（可以多买几个做分布式实验）</li><li>存储和计算分离（鱼和熊掌不可兼得）</li></ul><p>甚至还在v2ex上发了一个求助帖，链接在本文的最下方，各位看官看完本文可以去瞻仰下。并且通过搜索reddit上的homelab板块，以及chiphell以及YouTube B站上一些信息，甚至跟咸鱼的老板们也聊了不少。最终总结出来以下几个流派（排名不分先后）：</p><ul><li>NUC流派</li><li>笔记本流派</li><li>垃圾佬流派</li><li>其它流派</li></ul><p>以下就把相关流派的背景和研究历史跟大家一一道来。</p><h3 id=nuc流派>NUC流派</h3><h4 id=前言>前言</h4><p>就好像微软教育超极本厂商一样，Intel除了挤牙膏，也在教各位PC厂商，办公小电脑应该这么做一样。牙膏厂除了挤牙膏，在NUC这个系列上还是很成功的（打脸时间：大多数被大家用来做黑苹果用了）。</p><p>这其中比较火的就是NUC8 和 新出的NUC10了，其中NUC8 i5-beh这个系列性价比最高（多亏了牙膏挤的慢），再加上可以搞黑苹果的加成，咸鱼上的价格在2K左右（涨价后）。这2K你能买到什么呢？一个<a href=https://ark.intel.com/content/www/cn/zh/ark/products/135935/intel-core-i5-8259u-processor-6m-cache-up-to-3-80-ghz.html>Intel® Core™ i5-8259U Processor (4C / 8T, 2.3 / 3.8GHz, 6MB L2)</a> (cpubenchmark ：8131)的一个CPU，NUC11的CPU大概是 i5-1135G7 @ 2.40GHz (4C / 8T, 2.4 / 4.2GHz, 8MB L2) (cpubenchmark：<strong>10072</strong>)，而且网口终于有2.5G的了，但也就一个而已。</p><p>没了？是的！没了。不能够！下面就展开说说优势和劣势：</p><h4 id=优势>优势</h4><ul><li>一份钱一分货，这个8k的CPU benchmark跑分这个价位里也算市场价了。</li><li>体积还算比较小巧，而且reddit上一群老外说这玩意适合做homelab机器。</li><li>可以装黑苹果</li><li>有雷电3接口</li></ul><h4 id=劣势>劣势</h4><ul><li>一份钱一分货，然而性价比没有达到极致。AMD其实更加的Yes</li><li>体积确实比较小巧，但殊不知电源跟主机一样大，供电口不是USB-C口</li><li>只有一个网口</li><li>只能加一个硬盘</li><li>性价比不是很高</li><li>听说噪音不小</li></ul><h4 id=小结>小结</h4><p>这种流派如果有黑苹果需求，可以选择下。但是要忍受牙膏厂的CPU进化速度，及时是NUC11的CPU好像也搞不过AMD。我没有强烈的黑苹果需求，而且也没太看上这玩意的扩展性，其实最不能忍的还是那个跟主机差不多大小的砖头电源，可能可以用个氮化镓GaN？但是电源口不是USB-C口，所以这次还是不选了。</p><h3 id=笔记本流派>笔记本流派</h3><h4 id=前言-1>前言</h4><p>这个流派是收到网上一个小哥的测评，其实我很认同他的观点，无论是关于<strong>计算和存储分离</strong>，还是 <strong>控制总成本</strong> ，<strong>使用尽可能多的设备，形成冗余，提高性能和整体可用性</strong>。都是很多且值得借鉴的宝贵经验，本想找他的微信继续探讨，可惜并没有被通过。</p><p>其实在我最终决定之前，我还在最终的方案和这个流派之间徘徊。毕竟他提到的：</p><blockquote><p>一台自带显示器的设备，避免了有时调试设备还需要扯线，准备键盘鼠标等麻烦事。</p></blockquote><p>这个我也有切身的体验，把一个ATX加上N块硬盘的机器搬上搬下的痛苦体验是很酸爽的。这也导致我后来直接花重金“抢”到了一个IP KVM来解决这个痛苦的问题。</p><p>关于他两个的主要配置如下：</p><blockquote><ul><li>设备型号：ThinkPad L14</li><li>处理器：AMD Ryzen 7 PRO 4750U (8C / 16T, 1.7 / 4.1GHz, 4MB L2 / 8MB L3) / 15W TDP</li><li>内存配置：64G / 2667</li><li>磁盘位：1个磁盘位，NGFF</li><li>详细产品规格：<a href="https://psref.lenovo.com/Detail/ThinkPad/ThinkPad_L14_Gen_1_AMD?M=20U50000AT">官方网站</a></li></ul><p>而之前的台式服务器的配置则是：</p><ul><li>设备型号：Elite Desk 800 G4</li><li>处理器 Intel Core i7-8700 （6C / 12T, 3.2 / 4.6 GHz，1.5MB L2/ 12MB L3） / 65W TDP</li><li>内存配置：64GB / 2400</li><li>磁盘位：至少两块 NGFF 磁盘位，两块以上 SATA SDD 接入。</li><li>详细产品规格：<a href=https://support.hp.com/hk-zh/document/c06053607>官方网站</a></li></ul></blockquote><p>还有一个他新买的配置<a href="https://psref.lenovo.com/Detail/ThinkBook/ThinkBook_15_G3_ACL?M=21A4004UHH">ThinkBook 15 G3 ACL</a> 但是这款在淘宝上貌似卖的也不多。</p><p>这里同样说说笔记本流派对于我来说的优势和劣势：</p><h4 id=优势-1>优势</h4><ul><li>安静</li><li>有电池，再也不用害怕停电了</li><li>有键盘和屏幕</li><li>价格符合预算</li><li>没事还可以做点别的用途</li><li>CPU配置高，毕竟是zen3的架构</li></ul><h4 id=劣势-1>劣势</h4><ul><li>大多只能扩展一个磁盘</li><li>内存不能满配只能板载8+32 40G</li><li>贵 基本上那个新买的裸机基本上是5K左右了</li></ul><h4 id=小结-1>小结</h4><p>说实话，这种方案通过<a href=https://soulteary.com>苏洋同学</a>的分析，其中有很多观点和想法都是比较认同的。然而，可能由于彼此的需求可能不太一样。由于我买了一个IP KVM因此对于键盘和屏幕的需求可能退而求其次了。而且如果机器比较小 拿下来折腾也不费劲。而且家里笔记本有点过多，可能没有太多的精力再把其它的笔记本带出去的想法。在便携性和扩展性上，选择了后者。</p><h3 id=垃圾佬流派>垃圾佬流派</h3><h4 id=前言-2>前言</h4><p>说实话，这种流派其实是一开始最接近我的需求的了。比如性价比高、便宜、网卡多、性能好等需求。然而，在闲鱼上兜兜转转好几圈才发现，忽略了一个比较主要的因素：时间成本。虽然在研究的过程中是对过去20年的DIY产业的补课。但花去的时间可能有点不太值得，况且这只是走过的第一步，买回来之后可能还会有更多的折腾成本。特别是看完各种魔改之后的CPU，咸鱼上各色各样成色的小主机之后。越发的感觉，花钱买点时间陪陪家人或者充充电，在人生的这个阶段还是很有性价比的。所以果断的放弃了这种流派，但研究的过程还是很有意思的，还是花点时间把它写下来。不然就真的竹篮打水一场空了。</p><p>说了这么多，终于可以说正题了，这个流派就不按照优势劣势介绍了。直接介绍几个现阶段的热门系列吧。</p><h4 id=选型>选型</h4><p>联想m720q</p><ul><li>处理器：g4900t g4930 i3-8100 i5-8500t 9500t 9700t 8700T 8600t 9900T 等</li><li>扩展性：四网卡 可以上魔改CPU</li><li>主板：B360</li><li>价格：1K</li></ul><p><em><strong>这种小主机按理说应该是最适合的了，裸机1K左右。可以上PCIE的四网口，CPU任君挑选，正式版的CPU不过瘾还有魔改的CPU</strong></em></p><p>联想M93P</p><ul><li>处理器：g3220t i3-4130t i5-4590t 等</li><li>扩展性：可以上双网卡</li><li>主板： Q87</li><li>价格：820</li></ul><p>联想 m920q</p><ul><li>规格：同 m720q</li><li>扩展性：可以通过雷电扩展</li></ul><p>联想m920x</p><ul><li>CPU：8600t</li><li>扩展性：多个散热孔 可以上两个M2</li><li>价格：1.2K</li></ul><p>联想930x</p><ul><li>十代CPU</li><li>有pcie</li></ul><p>联想 m715q</p><ul><li>CPU：R3 2200ge 或R5 2400ge(4C8T 3.2 3.8 2M 4M 35W)</li><li>价格：500</li></ul><p>联想710q</p><ul><li>CPU：6-7-8代CPU</li><li>扩展性：铜底散热</li></ul><h4 id=小结-2>小结</h4><p>总结一句话就是：就是各种眼花缭乱，无从下口。基本上都是咸鱼上的货，所以要凭运气和勇气。当时没有买就是因为时间成本太高，还要自己再看配哪种CPU比较好，各种搭配和调试，从而忘记了自己的初衷。正所谓走的太远忘记为什么出发。不忘初心。不过如果下次可以玩的话，倒是可以在咸鱼上蹲守下m720q，如果有全套的倒是可以入一个玩玩。</p><h3 id=混合流派>混合流派</h3><h4 id=前言-3>前言</h4><p>其实这个流派应该属于笔记本的AMD流派+NUC流派的组合，其实就是找一下NUC那样的AMD主机。因为并不关系是不是能搞黑苹果，可以避开牙膏厂的套路。但是有的就有失，绕过牙膏厂的话，就只能放弃雷电3和AMT技术了。不过也还好，有IP KVM对于AMT也无所谓了。</p><h4 id=选型-1>选型</h4><p>华擎 A300：平台感觉有点老了，继任X300看看。</p><p>华擎 X300：Zen2架构 CPU还是有点小弱</p><p>以上这两种其实我都没细看，第一眼没有那种心动的感觉。可能比NUC便宜一点点，然而都半斤八两了。</p><p>直到从YouTube上看到了一个<a href=https://store.minisforum.com/products/minisforum-hm80>HM80</a>，一下子就看上了。说说看上的点吧：</p><ul><li>CPU性能还不错 zen2 4800U 跑分大概<strong>17249</strong></li><li>双网卡，其中一个还支持2.5G</li><li>可以扩展两个sata的SSD</li><li>总价一般，甚至有点小贵 3.5K</li></ul><p>加上64G内存和1T的SSD基本上是奔着5K去了，但可玩性可能稍微高一些。软路由（狗头）。</p><h4 id=小结-3>小结</h4><p>对于这个混合流派的话，其实是在咸鱼上乱逛，从某商家的留言里看到YouTube上有个博主介绍软路由比较好，再从他那里前几个月的视频中，看到HM80这个机器的。基本满足了我对于Homelab的期望。接下来就是下单，装机，开玩。不过这期间又有个纠结的点。4800U的CPU笔记本也只卖4K还带屏幕和8G内存还有512G SSD。拿回来加个32G内存+1K，总价也不过5K，然而人家有键盘！有屏幕！！有电池！！！不过都下单了，就那么回事吧。我看重的是扩展性对不。勿忘初心，给自己个心理安慰。还特意做了一个各个流派的对比表格：</p><table><thead><tr><th>考虑因素</th><th>NUC流派</th><th>笔记本流派</th><th>垃圾佬流派</th><th>混合流派</th></tr></thead><tbody><tr><td>扩展性</td><td>2</td><td>2</td><td>4</td><td>3</td></tr><tr><td>便携度</td><td>3</td><td>5</td><td>4</td><td>3</td></tr><tr><td>CPU性能</td><td>3</td><td>5</td><td>4</td><td>5</td></tr><tr><td>省心度</td><td>4</td><td>5</td><td>2</td><td>5</td></tr><tr><td>价格</td><td>3</td><td>3</td><td>5</td><td>4</td></tr></tbody></table><p>可能看的不太直观，做了一个雷达图，可能更直观一些。</p><p><img src=https://yimeng.cn-bj.ufileos.com/blog/image-20210828144712000.png alt=image-20210828144712000></p><h3 id=参考链接>参考链接</h3><p><a href="https://www.youtube.com/watch?v=3QjmJrjyVLg">https://www.youtube.com/watch?v=3QjmJrjyVLg</a></p><p><a href="https://www.chiphell.com/forum.php?mod=viewthread&amp;tid=2309337&amp;extra=&amp;page=2&amp;mobile=1">https://www.chiphell.com/forum.php?mod=viewthread&amp;tid=2309337&amp;extra=&amp;page=2&amp;mobile=1</a></p><p><a href=https://www.chiphell.com/thread-2173141-1-1.html>https://www.chiphell.com/thread-2173141-1-1.html</a></p></article></html>