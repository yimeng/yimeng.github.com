<!doctype html><html lang=zh-cn><title>阿里云k8s最佳实践 | 出租窝</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.125.3"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://git.yimeng.ch/post/2021/aliyun-k8s/><link rel=alternate type=application/rss+xml href title=出租窝><link rel=stylesheet href=https://git.yimeng.ch/css/theme.css><link rel=stylesheet href=https://git.yimeng.ch/css/classes.css><header class=dark><h2><a href=https://git.yimeng.ch/>出租窝</a></h2><nav></nav></header><article><header><h1><a href=https://git.yimeng.ch/post/2021/aliyun-k8s/>阿里云k8s最佳实践</a></h1><p class=meta><time datetime=2021-02-19T14:46:00+08:00>February 19, 2021</time></p></header><h1 id=阿里云k8s-规划手册>阿里云k8s 规划手册</h1><h2 id=k8s限制>K8S限制</h2><p>在 v1.19 版本中， Kubernetes 支持的最大节点数为 5000。更具体地说，我们支持满足以下所有条件的配置：</p><ul><li>节点数不超过 5000</li><li>Pod 总数不超过 150000</li><li>容器总数不超过 300000</li><li>每个节点的 pod 数量不超过 100</li></ul><h2 id=选型步骤>选型步骤</h2><ul><li>阿里云K8S分类</li><li>网络规划</li><li>ECS选型</li><li>网络选型</li><li>配置设置</li></ul><h2 id=阿里云k8s分类>阿里云k8s分类</h2><p>![image-20201124121734196](/Users/yimeng/Library/Application Support/typora-user-images/image-20201124121734196.png)</p><ol><li><p>生产环境 Dedicated K8S 自主可控</p></li><li><p>测试环境：Managed K8S 节省成本</p></li><li><p>持续集成 、Job任务：K8S Serverless</p><h2 id=heading></h2></li></ol><h2 id=网络规划>网络规划</h2><h3 id=vpc>VPC</h3><ol><li>K8S使用独立的VPC，不建议混用。如混用需要重新规划</li><li>单个VPC支持云资源使用的私网网络地址数量 60,000 VPC建议使用 16掩码：/16 65532</li><li>建议k8s独立的VPC，通过云企业网等打通。</li><li>单个地域支持创建的VPC的数量 10个 北京9个可用区 共计 90个VPC</li></ol><h3 id=交换机>交换机</h3><ol><li>交换机网段建议使用20(4094)-21(2046)掩码（为了最大利用IP地址，虚拟机一般用24掩码即可）</li><li>单个VPC支持创建的交换机的数量 24个(阿里云限制)</li><li>每个交换机平均掩码长度/20-/21 可用IP数 2044-4092 * 24 ~ 49056 &lt; 65532 &lt; 98208</li><li>service 数量 1.5:5 svc:pod 1.5w 预留</li></ol><h2 id=ecs选型>ECS选型</h2><h3 id=神龙>神龙</h3><p>Node 配置104C 384G 12000/月 每个POD：2C4G 每个Node ~100&lt;110 POD</p><h3 id=ecs>ECS</h3><p>2C4G EC2 197/月*100台ECS虚拟机 19700/月</p><p>节省25%~40%</p><p>北京<strong>A</strong>，<strong>B</strong>，<strong>C</strong>，<strong>D</strong>，<strong>E</strong>，杭州<strong>BCDE</strong>，上海<strong>D</strong>可用区不可以再扩容，售卖规格对新用户停售。</p><h2 id=网络选型>网络选型</h2><p>flannel：如果有一些二次开发的系统以来，可以继续使用。</p><p>terway：阿里云推荐，可以进行网络隔离和独立网卡使用。POD和Node可以处于同一网络平面</p><h2 id=配置设置>配置设置</h2><p>区域：北京</p><p>VPC 10.0.0.0/16 (65532 IP)</p><p>Switch（4092 IP）: 北京F 10.1.0.0/20 北京 G 10.1.16.0/20 北京H 10.1.32.0/20</p><p>网络类型：terway</p><p>Service CIDR(16382)：10.0.0.0/18 (每个集群只能创建一次)</p><p>配置SNAT ：是</p><p>公网访问：生产不建议打开 测试可以打开</p><p>kube-proxy：IPVS</p><p>实例规格：生产建议使用神龙服务器，测试可以选择ECS</p><p>存储插件：CSI</p></article></html>